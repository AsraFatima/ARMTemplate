{
  "handler": "Microsoft.Compute.MultiVm",
  "version": "0.0.1-preview",
  "parameters": {
    "basics": [

    ],
    "steps": [
      {
        "name": "infraConfig",
        "label": "Deployment settings",
        "subLabel": {
          "preValidation": "Configure deployment settings",
          "postValidation": "Done"
        },
        "bladeTitle": "Service Principal settings",
        "elements": [
          {
            "name": "adminSettings",
            "type": "Microsoft.Common.Section",
            "label": "Azure Service Principal",
            "elements": [
              {
                "name": "applicationId",
                "type": "Microsoft.Common.TextBox",
                "label": "Application Id",
                "toolTip": "Specify the administrator user name for NetScaler, XenApp, and Active Directory. The user name cannot exceed 9 characters.",
                "defaultValue": "",
                "constraints": {
                  "required": true,
                  "validationMessage": "Application Id of the Azure Service Principal is mandatory."
                }
              },
              {
                "name": "tenantId",
                "type": "Microsoft.Common.TextBox",
                "label": "Tenant Id",
                "toolTip": "Specify the administrator password for NetScaler, XenApp and Active Directory. The passwords cannot contain consecutive special characters as the Netscaler configuration fails when we have multiple special characters in the password. The fix for this issue should be available soon.",
                "defaultValue":"",
                 "constraints": {
                  "required": true,
                  "ValidationMessage": "Tenant Id of the Subscription is mandatory."
                }
              },
              {
                "name": "certThumbprint",
                "type": "Microsoft.Common.TextBox",
                "label": "Certificate Thumbprint",
                "defaultValue": "",
                "toolTip": "Specify the Certificate thumbprint of the Azure Service Principal.",
                "constraints": {
                  "required": true,
                  "validationMessage": "Must be a valid email address."
                }
              }

            ]
          },

          {
            "name": "virtualMachineSettings",
            "type": "Microsoft.Common.Section",
            "label": "Virtual Machine Settings",
            "elements": [
              {
                "name": "vhdStorageType",
                "type": "Microsoft.Common.DropDown",
                "label": "VM Disk Type",
                "defaultValue": "Standard_LRS",
                "toolTip": "Select the storage type for the deployment.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "HDD",
                      "value": "Standard_LRS"
                    },
                    {
                      "label": "SSD",
                      "value": "Premium_LRS"
                    }
                  ]
                },
                "visible": "[not(equals(location(),'eastasia'))]"                
              },
              {
                "name": "vmSizePremium",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Size",
                "toolTip": "Specify the size of all the virtual machines in the deployment. A total of 6 virtual machines of the specified size will be created as a part of the solution template deployment.",
                "recommendedSizes": [
                  "Standard_DS2_v2",
                  "Standard_DS3_v2",
                  "Standard_DS4_v2"
                ],
                "constraints": {
                  "allowedSizes": [
                    "Standard_DS2_v2",
                    "Standard_DS3_v2",
                    "Standard_DS4_v2",
                    "Standard_DS5_v2",
                    "Standard_DS11_v2",
                    "Standard_DS12_v2",
                    "Standard_DS13_v2",
                    "Standard_DS14_v2",
                    "Standard_DS15_v2",
                    "Standard_DS2",
                    "Standard_DS3",
                    "Standard_DS4",
                    "Standard_DS11",
                    "Standard_D12",
                    "Standard_DS13",
                    "Standard_DS14",
                    "Standard_GS1",
                    "Standard_GS2",
                    "Standard_GS3",
                    "Standard_GS4"
                  ]
                },
                "visible": "[contains(steps('infraConfig').virtualMachineSettings.vhdStorageType,'Premium_LRS')]",
                "osPlatform": "Windows",
                "imageReference": {
                  "publisher": "MicrosoftWindowsServer",
                  "offer": "WindowsServer",
                  "sku": "2012‐R2‐Datacenter"
                },
                "count": 6
              },
              {
                "name": "vmSizeStandard",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Size",
                "toolTip": "Specify the size of all the virtual machines in the deployment. A total of 6 virtual machines of the specified size will be created as a part of the solution template deployment.",
                "recommendedSizes": [
                  "Standard_D2_v2",
                  "Standard_D3_v2",
                  "Standard_D4_v2"
                ],
                "constraints": {
                  "allowedSizes": [                  
                    "Standard_A3",
                    "Standard_A4",
                    "Standard_D12",
                    "Standard_D13",
                    "Standard_D14",
                    "Standard_G2",
                    "Standard_G3",
                    "Standard_G4",
                    "Standard_G5",
                    "Standard_D2_v2",
                    "Standard_D3_v2",
                    "Standard_D4_v2",
                    "Standard_D5_v2",
                    "Standard_D11_v2",
                    "Standard_D12_v2"
                  ]
                },
                "visible": "[contains(steps('infraConfig').virtualMachineSettings.vhdStorageType,'Standard_LRS')]",
                "osPlatform": "Windows",
                "imageReference": {
                  "publisher": "MicrosoftWindowsServer",
                  "offer": "WindowsServer",
                  "sku": "2012‐R2‐Datacenter"
                },
                "count": 6
              }
            ]
          },

          {
            "name": "vdaSettings",
            "type": "Microsoft.Common.Section",
            "label": "XenApp VDA Settings",
            "elements": [
              {
                "name": "vdaVersion",
                "type": "Microsoft.Common.DropDown",
                "label": "XenApp VDA version",
                "defaultValue": "Windows Server 2012 R2",
                "toolTip": "Select the Operating System version for the XenApp VDA that needs to be deployed in the XenApp Trial environment.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "Windows Server 2012 R2",
                      "value": "coldfire"
                    },
                    {
                      "label": "Windows Server 2016 Datacenter",
                      "value": "server2016"
                    }
                  ]
                },
                "visible": true
              }

            ]
          }

        ]
      }
    ],
    "outputs": {
      "adminUsername": "[steps('infraConfig').adminSettings.adminUsername]",
      "adminPassword": "[steps('infraConfig').adminSettings.adminPassword.password]",
      "vhdStorageType": "[steps('infraConfig').virtualMachineSettings.vhdStorageType]",
      "emailAddress": "[steps('infraConfig').adminSettings.emailAddress]",
      "machineSize": "[coalesce(steps('infraConfig').virtualMachineSettings.vmSizePremium,steps('infraConfig').virtualMachineSettings.vmSizeStandard) ]",
      "vdaVersion": "[steps('infraConfig').vdaSettings.vdaVersion]",
      "location": "[location()]"
    }
  }
}